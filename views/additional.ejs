<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <title>Sample Site</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
      integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
      crossorigin="anonymous"
    ></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="/public/css/style.css" type="text/css" />
  </head>
  <body>
    <div class="container">
      <nav class="navbar navbar-default ">
        <div class="container-fluid">
          <div class="navbar-collapse collapse ">
            <ul class="nav navbar-nav">
              <li>
                <img
                  src="/public/img/logo2.png"
                  with="94"
                  height="45"
                  alt="logo"
                  srcset=""
                  style="margin-right: 20px;"
                />
              </li>
              <li class="active"><a href="/home/dashboard">Powtót</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="/home/logout">Wylogowanie</a></li>
            </ul>
          </div>
        </div>
      </nav>
      <!-- Main component for a primary marketing message or call to action -->
      <div class="jumbotron">
        <h2>Zarządzanie zamówieniami</h2>
        <div style="display: flex;">
          <div>
            <p style="margin-bottom: 0;">Wybierz użytkownika:</p>
            <select id="userDB" name="userDB" style="font-size: 18px; padding: 2px 18px ;" >
              <option value="empty">wybierz ...</option>
              <option value="48177">Rafał Ziętak</option>
              <option value="1111">Piotr Łebek</option>
              <option value="3333">Anna Nyk</option>
            </select>
          </div>
          <div style="margin-left: 50px">
            <p style="margin-bottom: 0;">Wybierz date:</p>
            <input
              type="date"
              name="lunch_order"
              id="lunch_order"
              style="font-size: 14px; padding: 2px 10px ;"
            />
            <p id="mesg" style="color:red; font-size: 14px;"></p>
          </div>
        </div>
        <p hidden id="sesa_no1"></p>
        <p style="margin-bottom: 0;">Lista aktualnych zamówień:</p>
        <table
          id="table"
          class="table"
          data-locale="pl-PL"
          data-search="true"
          data-show-export="true"
        >
          <thead>
            <tr>
              <th data-field="id">ID</th>
              <th data-field="Id_sesa_no">SESA</th>
              <th data-field="order_date">Data</th>
              <th data-field="order_supplier_name">Dostawca</th>
              <th data-field="order_no">Nr. dania</th>
              <th data-field="order_name">Danie</th>
              <th data-field="order_price">Cena</th>
            </tr>
          </thead>
        </table>
        <br />
        <p>
          Masz do wyborów dwóch dostawców <strong>Mucha</strong> i
          <strong>Opoka</strong> , kliknij odpowiednią zakładkę
        </p>
        <p hidden id="activeSupplier"></p>
        <!-- dynamic tabs -->
        <ul class="nav nav-tabs">
          <li><a data-toggle="tab" href="#mucha">Mucha</a></li>
          <li><a data-toggle="tab" href="#opoka">Opoka</a></li>
        </ul>

        <div class="tab-content">
          <div id="mucha" class="tab-pane fade in active">
            <h2 hidden id="titleMucha">Mucha</h2>
            <br />
            <p style="margin-bottom: 0; ">wybierz danie:</p>
            <table
              class="table"
              data-toggle="table"
              id="table_mucha"
              data-locale="pl-PL"
              data-search="true"
              data-height="400"
              data-show-export="true"
              data-click-to-select="true"
              data-pagination="true"
              data-show-pagination-switch="true"
              data-pagination-pre-text="Poprzedni"
              data-pagination-next-text="Następny"
              data-page-list="[3, 5, 10, 15, all]"
              data-response-handler="responseHandler"
            >
              <thead>
                <tr>
                  <th data-field="id">ID</th>
                  <th data-field="supplier_name">Dostawca</th>
                  <th data-field="menu_no">Numer dania</th>
                  <th data-field="menu_desctription">opis Dania</th>
                  <th data-field="menu_price">Cena</th>
                  <th data-field="order">Zamów</th>
                </tr>
              </thead>
            </table>
          </div>
          <div id="opoka" class="tab-pane fade">
            <h2 hidden id="titleOpoka">Opoka</h2>
            <br />
            <p>wybierz danie:</p>
            <table
              id="table_opoka"
              data-locale="pl-PL"
              data-search="true"
              data-height="400"
              data-show-export="true"
              data-click-to-select="true"
              data-pagination="true"
              data-show-pagination-switch="true"
              data-pagination-pre-text="Previous"
              data-pagination-next-text="Next"
              data-page-list="[3, 5, 10, 15, all]"
              data-response-handler="responseHandler"
            >
              <thead>
                <tr>
                  <th data-field="id">ID</th>
                  <th data-field="supplier_name">Dostawca</th>
                  <th data-field="menu_no">Numer dania</th>
                  <th data-field="menu_desctription">opis Dania</th>
                  <th data-field="menu_price">Cena</th>
                  <th data-field="order">Zamów</th>
                </tr>
              </thead>
            </table>
          </div>
        </div>
      </div>
    </div>
    <!-- js -->
    <script src="/public/additional.js"></script>

    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
      integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/bootstrap-table@1.15.5/dist/bootstrap-table.min.css"
    />
    <script src="https://unpkg.com/bootstrap-table@1.15.5/dist/bootstrap-table.min.js"></script>
    <script src="https://unpkg.com/tableexport.jquery.plugin/tableExport.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.15.5/dist/extensions/export/bootstrap-table-export.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.15.5/dist/bootstrap-table-locale-all.min.js"></script>
    <script>
      window.onload = function() {
        var $table = $("#table");
        var $table_mucha = $("#table_mucha");
        var $table_opoka = $("#table_opoka");
        var $remove = $("#remove");
        var selections = [];
        var fname, sesa_no1;

        // Make a request for a user with a given ID
        axios
          .post("/home/additional", {
            my_date: document.getElementById("lunch_order").value,
            my_supplier: document.getElementById("activeSupplier").innerText
          })
          .then(function(response) {
            // handle success
            var userDB = document.getElementById("userDB");
            var users_json = response.data.users_json;
            var users_json2 = JSON.stringify(users_json);
            console.log("users_json: " + users_json2);
            // var j=0;
            // for (let i=0; i< users_json.length; i++) {
            //     const el = users_json[i];
                
            //     console.log("sesa: " + el.sesa_no);
            //     var listName = el.first_name + " " + el.last_name;
            //     console.log("imię i nazwisko: " + listName);
            //     if (j = 0) {
            //       console.log ("OK")
            //       j=j+1
            //     } else {
            //       userDB.options[j].value = el.sesa_no;
            //       userDB.options[j].text = listName;
            //       j=j+1;
            //     }
                
                               
            // }

            var table_data = response.data.table_data;
            var table_data2 = JSON.stringify(table_data);
            console.log("table_data: " + table_data2);
            $table.bootstrapTable("destroy");
            $table.bootstrapTable({
              data: table_data,
              columns: [
                ,
                ,
                ,
                ,
                ,
                ,
                ,
                {
                  field: "operate",
                  title: "Usuń",
                  align: "center",
                  clickToSelect: false,
                  events: window.operateEvents,
                  formatter: operateFormatter
                }
              ]
            });
            var table_supplier = response.data.table_supplier;
            var table_supplier1 = JSON.stringify(table_supplier);
            console.log("table_supplier1: " + table_supplier1);
            $table_mucha.bootstrapTable("destroy");
            $table_mucha.bootstrapTable({
              data: table_supplier,
              columns: [
                ,
                ,
                ,
                ,
                ,
                {
                  field: "order",
                  title: "Zamów",
                  align: "center",
                  clickToSelect: false,
                  events: window.operateEvents2,
                  formatter: operateFormatter2
                }
              ]
            });
            $table_opoka.bootstrapTable("destroy");
            $table_opoka.bootstrapTable({
              data: table_supplier,
              columns: [
                ,
                ,
                ,
                ,
                ,
                {
                  field: "order",
                  title: "Zamów",
                  align: "center",
                  clickToSelect: false,
                  events: window.operateEvents2,
                  formatter: operateFormatter2
                }
              ]
            });
          })
          .catch(function(error) {
            // handle error
            console.log(error);
          })
          .finally(function() {
            // always executed
          });

        function getIdSelections() {
          return $.map($table.bootstrapTable("getSelections"), function(row) {
            return row.id;
          });
        }
        function responseHandler(res) {
          $.each(res.rows, function(i, row) {
            row.state = $.inArray(row.id, selections) !== -1;
          });
          return res;
        }
        function detailFormatter(index, row) {
          var html = [];
          $.each(row, function(key, value) {
            html.push("<p><b>" + key + ":</b> " + value + "</p>");
          });
          return html.join("");
        }
        function operateFormatter(value, row, index) {
          return [
            '<a class="remove" href="javascript:void(0)" title="Usuń">',
            '<i class="fa fa-trash"></i>',
            "</a>"
          ].join("");
        }
        window.operateEvents = {
          "click .remove": function(e, value, row, index) {
            $table.bootstrapTable("remove", {
              field: "id",
              values: [row.id]
            });
            myFunction_delete2(row.id);
          }
        };
        function operateFormatter2(value, row, index) {
          return [
            '<a class="order" href="javascript:void(0)" title="Zamów">',
            '<i class="fas fa-utensils"></i>',
            "</a>"
          ].join("");
        }
        window.operateEvents2 = {
          "click .order": function(e, value, row, index) {
            var userDB = document.getElementById("userDB");
            var result = userDB.options[userDB.selectedIndex].value;
            if (result == "empty") {
              alert ("Musisz wybrać dla kogo zamawiasz obiad")
              return
            }
            // var result2 = userDB.options[userDB.selectedIndex].text;
            myFunction_order2(row.id, result); // CHANGE STRATEGY FROM MENU_NO TO ID
          }
        };
        function totalTextFormatter(data) {
          return "Total";
        }
        function totalNameFormatter(data) {
          return data.length;
        }
        function totalPriceFormatter(data) {
          var field = this.field;
          return (
            "$" +
            data
              .map(function(row) {
                return +row[field].substring(1);
              })
              .reduce(function(sum, i) {
                return sum + i;
              }, 0)
          );
        }
      };
      // Koniec funkcji
    </script>
  </body>
</html>
